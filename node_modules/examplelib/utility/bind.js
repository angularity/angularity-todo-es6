/**
 * <p>Bind any method or accessors in the given descriptor to the given target.</p>
 * @param {object} descriptor Descriptor as returned by <code>Object.getOwnPropertyDescriptor()</code>
 * @param {object} target The object that methods will be bound to
 */
function bindDescriptor(descriptor, target) {
  'use strict';
  var FIELDS = [ 'get', 'set', 'value' ];
  for (var field of FIELDS) {
    if ((field in descriptor) && (typeof descriptor[field] === 'function')) {
      descriptor[field] = descriptor[field].bind(target);
    }
  }
}

/**
 * <p>Bind all methods and accessors of the given candidate to itself (in-place) and return the candidate.</p>
 * @param {object|function} candidate An instance with a prototype
 * @returns {object|function} The given candidate
 */
export default function bind(candidate) {
  'use strict';
  var isValid = (candidate) && ((typeof candidate === 'object') || (typeof candidate === 'function'));
  if (isValid) {
    for (var name in candidate) {

      // find the property on the candidate or its prototype chain
      var current    = candidate;
      var descriptor = null;
      while (current && !(descriptor)) {
        descriptor = Object.getOwnPropertyDescriptor(current, name);
        current    = Object.getPrototypeOf(current);
      }

      // bind the descriptor and apply it to the given candidate
      bindDescriptor(descriptor, candidate);
      Object.defineProperty(candidate, name, descriptor);
    }
  }
  return candidate;
}
